### Grahplet API Test Requests
@baseUrl = http://localhost:5188
@email = demo@example.com
@password = demo
@missingId = 00000000-0000-0000-0000-000000000001
@newUsername = testuser_{{$timestamp}}
@newEmail = testuser_{{$timestamp}}@example.com
@newPassword = P@ssw0rd!

### Login
POST {{baseUrl}}/api/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    client.test("Login succeeds with demo credentials", function () {
        client.assert(response.status === 200, "Expected 200 OK");
        client.assert(!!response.body.token, "Token should be present in body");
    });
    client.global.set("token", response.body.token);
%}

### Register New User
POST {{baseUrl}}/api/user/register
Content-Type: application/json

{
  "name": "{{newUsername}}",
  "email": "{{newEmail}}",
  "password": "{{newPassword}}"
}

> {%
    client.test("Register returns 201 Created or 409 Conflict if already exists", function () {
        client.assert([201,409].includes(response.status), "Expected 201 or 409");
    });
%}

### Login with New User
POST {{baseUrl}}/api/login
Content-Type: application/json

{
  "email": "{{newEmail}}",
  "password": "{{newPassword}}"
}

> {%
    client.test("Login as new user succeeds", function () {
        client.assert(response.status === 200, "Expected 200 OK");
        client.assert(!!response.body.token, "Token should be present");
    });
    client.global.set("token_new", response.body.token);
%}

### Get Current User (me)
GET {{baseUrl}}/api/user/me
Authorization: {{token_new}}

> {%
    client.test("Get current user returns 200 and has expected fields", function () {
        client.assert(response.status === 200);
        client.assert(!!response.body.id, "User id should be present");
        client.assert(!!response.body.username, "Username should be present");
        client.assert(response.body.password === "", "Password should be empty in response");
    });
    // Save current user's id for public fetch test
    client.global.set("currentUserId", response.body.id);
%}

### Get Current User (me) - unauthorized → 401
GET {{baseUrl}}/api/user/me

> {%
    client.test("/me requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Get Public User by Id (no auth required)
GET {{baseUrl}}/api/user/{{currentUserId}}

> {%
    client.test("Public user endpoint returns 200 and PublicUser shape", function () {
        client.assert(response.status === 200);
        client.assert(!!response.body.id, "PublicUser id present");
        client.assert(!!response.body.username, "PublicUser username present");
        client.assert(response.body.profilePicUrl !== undefined, "PublicUser profilePicUrl present");
        client.assert(response.body.password === undefined, "Password field must not be returned");
        client.assert(response.body.email === undefined, "Email must not be returned in public profile");
    });
%}

### Get Public User - not found → 404
GET {{baseUrl}}/api/user/{{missingId}}

> {%
    client.test("Public user endpoint returns 404 for non-existing id", function () {
        client.assert(response.status === 404);
    });
%}

### Update Current User (me)
PUT {{baseUrl}}/api/user/me
Authorization: {{token_new}}
Content-Type: application/json

{
  "profilePicUrl": "https://example.com/newpic/{{newUsername}}.png",
  "username": "{{newUsername}}_updated"
}

> {%
    client.test("Update current user returns 200 and updates fields", function () {
        client.assert(response.status === 200);
        client.assert(response.body.username.endsWith("_updated"), "Username should be updated");
        client.assert(response.body.profilePicUrl.includes("newpic"), "ProfilePicUrl should be updated");
    });
%}

### Login - invalid credentials → 401
POST {{baseUrl}}/api/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "wrong-password"
}

> {%
    client.test("Login fails with invalid credentials", function () {
        client.assert(response.status === 401, "Expected 401 Unauthorized");
    });
%}

### Login - bad request (missing password) → 400
POST {{baseUrl}}/api/login
Content-Type: application/json

{
  "email": "{{email}}"
}

> {%
    client.test("Login fails with bad request when password missing", function () {
        client.assert(response.status === 400, "Expected 400 Bad Request");
    });
%}

### List Workspaces
GET {{baseUrl}}/api/workspace
Authorization: {{token}}

> {%
    client.test("List workspaces returns 200 with valid auth", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body), "Expected array of workspaces");
    });
%}

### List Workspaces - unauthorized → 401
GET {{baseUrl}}/api/workspace

> {%
    client.test("List workspaces requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Create Workspace
POST {{baseUrl}}/api/workspace
Authorization: {{token}}
Content-Type: application/json

{
  "name": "My First Workspace"
}

> {%
    if (response.status === 201) {
        client.global.set("workspaceId", response.body.id);
    }
    client.test("Create workspace returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id, "Workspace id should be present");
    });
%}

### Create Workspace - bad request (missing name) → 400
POST {{baseUrl}}/api/workspace
Authorization: {{token}}
Content-Type: application/json

{
}

> {%
    client.test("Create workspace fails with 400 when name missing", function () {
        client.assert(response.status === 400);
    });
%}

### Get Workspace
GET {{baseUrl}}/api/workspace/{{workspaceId}}
Authorization: {{token}}

> {%
    client.test("Get workspace returns 200 for existing id", function () {
        client.assert(response.status === 200);
    });
%}

### Update Workspace
PUT {{baseUrl}}/api/workspace/{{workspaceId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Updated Workspace"
}

> {%
    client.test("Update workspace returns 200 for existing id", function () {
        client.assert(response.status === 200);
    });
%}

### Get Workspace - not found → 404
GET {{baseUrl}}/api/workspace/{{missingId}}
Authorization: {{token}}

> {%
    client.test("Get workspace returns 404 for non-existing id", function () {
        client.assert(response.status === 404);
    });
%}

### Create Tag
POST {{baseUrl}}/api/workspace/{{workspaceId}}/tags
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Important",
  "color": [255, 0, 0]
}

> {%
    if (response.status === 201) {
        client.global.set("tagId", response.body.id);
    }
    client.test("Create tag returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id);
    });
%}

### List Tags
GET {{baseUrl}}/api/workspace/{{workspaceId}}/tags
Authorization: {{token}}

> {%
    client.test("List tags returns 200 and array", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body));
    });
%}

### Get Tag
GET {{baseUrl}}/api/workspace/{{workspaceId}}/tags/{{tagId}}
Authorization: {{token}}

> {%
    client.test("Get tag returns 200 for existing tag", function () {
        client.assert(response.status === 200);
    });
%}

### Update Tag
PUT {{baseUrl}}/api/workspace/{{workspaceId}}/tags/{{tagId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Very Important",
  "color": [0, 255, 0]
}

> {%
    client.test("Update tag returns 200 for existing tag", function () {
        client.assert(response.status === 200);
    });
%}

### Create Tag - bad request (invalid color) → 400
POST {{baseUrl}}/api/workspace/{{workspaceId}}/tags
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Broken",
  "color": [255, 0]
}

> {%
    client.test("Create tag fails with 400 on invalid color", function () {
        client.assert(response.status === 400);
    });
%}

### Get Tag - not found → 404
GET {{baseUrl}}/api/workspace/{{workspaceId}}/tags/{{missingId}}
Authorization: {{token}}

> {%
    client.test("Get tag returns 404 for non-existing tag", function () {
        client.assert(response.status === 404);
    });
%}

### Create Note (Text)
POST {{baseUrl}}/api/workspace/{{workspaceId}}/note
Authorization: {{token}}
Content-Type: application/json

{
  "name": "My First Note",
  "kind": "txt",
  "value": "This is a test note with some content",
  "positionX": 100.5,
  "positionY": 200.75
}

> {%
    if (response.status === 201) {
        client.global.set("noteId", response.body.id);
    }
    client.test("Create note (txt) returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id);
    });
%}

### Create Note (URL)
POST {{baseUrl}}/api/workspace/{{workspaceId}}/note
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Useful Link",
  "kind": "url",
  "value": "https://example.com",
  "positionX": 300.0,
  "positionY": 150.25
}

> {%
    if (response.status === 201) {
        client.global.set("noteId2", response.body.id);
    }
    client.test("Create note (url) returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id);
    });
%}

### List Notes
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note
Authorization: {{token}}

> {%
    client.test("List notes returns 200 and array", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body));
    });
%}

### Get Note
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}
Authorization: {{token}}

> {%
    client.test("Get note returns 200 for existing note", function () {
        client.assert(response.status === 200);
    });
%}

### Update Note
PUT {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Updated Note Title",
  "value": "Updated content",
  "positionX": 250.5,
  "positionY": 350.0
}

> {%
    client.test("Update note returns 200 for existing note", function () {
        client.assert(response.status === 200);
    });
%}

### Create Note - bad request (missing name/kind) → 400
POST {{baseUrl}}/api/workspace/{{workspaceId}}/note
Authorization: {{token}}
Content-Type: application/json

{
}

> {%
    client.test("Create note fails with 400 when required fields missing", function () {
        client.assert(response.status === 400);
    });
%}

### Get Note - not found → 404
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{missingId}}
Authorization: {{token}}

> {%
    client.test("Get note returns 404 for non-existing note", function () {
        client.assert(response.status === 404);
    });
%}

### Attach Tag to Note
PUT {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/tags/{{tagId}}
Authorization: {{token}}

> {%
    client.test("Attach tag returns 200 and note payload", function () {
        client.assert(response.status === 200);
    });
%}

### Get Note-Tag Association
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/tags/{{tagId}}
Authorization: {{token}}

> {%
    client.test("Get note-tag association returns 200", function () {
        client.assert(response.status === 200);
    });
%}

### Create Note Relation
POST {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation
Authorization: {{token}}
Content-Type: application/json

{
  "otherId": "{{noteId2}}",
  "name": "references"
}

> {%
    if (response.status === 201) {
        client.global.set("relationId", response.body.id);
    }
    client.test("Create relation returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id);
    });
%}

### Get Note Relation
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation/{{relationId}}
Authorization: {{token}}

> {%
    client.test("Get relation returns 200", function () {
        client.assert(response.status === 200);
    });
%}

### Update Relation
PUT {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation/{{relationId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "strongly_references"
}

> {%
    client.test("Update relation returns 200", function () {
        client.assert(response.status === 200);
    });
%}

### Create Relation - bad request (missing fields) → 400
POST {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation
Authorization: {{token}}
Content-Type: application/json

{
  "name": ""
}

> {%
    client.test("Create relation fails with 400 when fields missing/invalid", function () {
        client.assert(response.status === 400);
    });
%}

### Get Relation - not found → 404
GET {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation/{{missingId}}
Authorization: {{token}}

> {%
    client.test("Get relation returns 404 for non-existing relation", function () {
        client.assert(response.status === 404);
    });
%}

### Detach Tag from Note
DELETE {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/tags/{{tagId}}
Authorization: {{token}}

> {%
    client.test("Detach tag returns 204", function () {
        client.assert(response.status === 204);
    });
%}

### Delete Note Relation
DELETE {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}/relation/{{relationId}}
Authorization: {{token}}

> {%
    client.test("Delete relation returns 204", function () {
        client.assert(response.status === 204);
    });
%}

### Delete Note
DELETE {{baseUrl}}/api/workspace/{{workspaceId}}/note/{{noteId}}
Authorization: {{token}}

> {%
    client.test("Delete note returns 204", function () {
        client.assert(response.status === 204);
    });
%}

### Delete Tag
DELETE {{baseUrl}}/api/workspace/{{workspaceId}}/tags/{{tagId}}
Authorization: {{token}}

> {%
    client.test("Delete tag returns 204", function () {
        client.assert(response.status === 204);
    });
%}

### Delete Workspace
DELETE {{baseUrl}}/api/workspace/{{workspaceId}}
Authorization: {{token}}

> {%
    client.test("Delete workspace returns 204", function () {
        client.assert(response.status === 204);
    });
%}

### List Organizations
GET {{baseUrl}}/api/organization
Authorization: {{token}}

> {%
    client.test("List organizations returns 200 with valid auth", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body), "Expected array of organizations");
    });
%}

### List Organizations - unauthorized → 401
GET {{baseUrl}}/api/organization

> {%
    client.test("List organizations requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Create Organization
POST {{baseUrl}}/api/organization
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Test Organization {{$timestamp}}"
}

> {%
    if (response.status === 201) {
        client.global.set("orgId", response.body.id);
    }
    client.test("Create organization returns 201 and id", function () {
        client.assert(response.status === 201);
        client.assert(!!response.body.id, "Organization id should be present");
        client.assert(!!response.body.name, "Organization name should be present");
    });
%}

### Create Organization - bad request (missing name) → 400
POST {{baseUrl}}/api/organization
Authorization: {{token}}
Content-Type: application/json

{
}

> {%
    client.test("Create organization fails with 400 when name missing", function () {
        client.assert(response.status === 400);
    });
%}

### Get Organization
GET {{baseUrl}}/api/organization/{{orgId}}
Authorization: {{token}}

> {%
    client.test("Get organization returns 200 for existing id", function () {
        client.assert(response.status === 200);
        client.assert(!!response.body.id, "Organization id should be present");
        client.assert(!!response.body.name, "Organization name should be present");
    });
%}

### Get Organization - not found → 404
GET {{baseUrl}}/api/organization/{{missingId}}
Authorization: {{token}}

> {%
    client.test("Get organization returns 404 for non-existing id", function () {
        client.assert(response.status === 404);
    });
%}

### Get Organization - unauthorized → 401
GET {{baseUrl}}/api/organization/{{orgId}}

> {%
    client.test("Get organization requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Update Organization
PUT {{baseUrl}}/api/organization/{{orgId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Updated Organization Name"
}

> {%
    client.test("Update organization returns 200 for existing id", function () {
        client.assert(response.status === 200);
        client.assert(response.body.name === "Updated Organization Name", "Name should be updated");
    });
%}

### Update Organization - not found → 404
PUT {{baseUrl}}/api/organization/{{missingId}}
Authorization: {{token}}
Content-Type: application/json

{
  "name": "Should Not Work"
}

> {%
    client.test("Update organization returns 404 for non-existing id", function () {
        client.assert([404, 403].includes(response.status));
    });
%}

### Get Organization Workspaces
GET {{baseUrl}}/api/organization/{{orgId}}/workspaces
Authorization: {{token}}

> {%
    client.test("Get organization workspaces returns 200 and array", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body), "Expected array of workspace IDs");
    });
%}

### Get Organization Workspaces - unauthorized → 401
GET {{baseUrl}}/api/organization/{{orgId}}/workspaces

> {%
    client.test("Get organization workspaces requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Get My Workspace Access
GET {{baseUrl}}/api/access/workspace/{{workspaceId}}
Authorization: {{token}}

> {%
    client.test("Get workspace access returns 200 or 404", function () {
        client.assert([200, 404].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.userId, "UserId should be present");
            client.assert(!!response.body.workspaceId, "WorkspaceId should be present");
            client.assert(!!response.body.accessLevel, "AccessLevel should be present");
        }
    });
%}

### Get My Workspace Access - unauthorized → 401
GET {{baseUrl}}/api/access/workspace/{{workspaceId}}

> {%
    client.test("Get workspace access requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### List Workspace Access (Admin required)
GET {{baseUrl}}/api/access/workspace/{{workspaceId}}/list
Authorization: {{token}}

> {%
    client.test("List workspace access returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(Array.isArray(response.body), "Expected array of access entries");
        }
    });
%}

### Grant Workspace Access (Admin required)
POST {{baseUrl}}/api/access/workspace/{{workspaceId}}/grant
Authorization: {{token}}
Content-Type: application/json

{
  "targetUserId": "{{currentUserId}}",
  "accessLevel": "Read"
}

> {%
    client.test("Grant workspace access returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.userId, "UserId should be present");
            client.assert(!!response.body.accessLevel, "AccessLevel should be present");
        }
    });
%}

### Update Workspace Access (Admin required)
PUT {{baseUrl}}/api/access/workspace/{{workspaceId}}/update
Authorization: {{token}}
Content-Type: application/json

{
  "targetUserId": "{{currentUserId}}",
  "accessLevel": "Write"
}

> {%
    client.test("Update workspace access returns 200, 403, or 404", function () {
        client.assert([200, 403, 404].includes(response.status));
    });
%}

### Revoke Workspace Access (Admin required)
DELETE {{baseUrl}}/api/access/workspace/{{workspaceId}}/revoke/{{currentUserId}}
Authorization: {{token}}

> {%
    client.test("Revoke workspace access returns 204, 403, or 404", function () {
        client.assert([204, 403, 404].includes(response.status));
    });
%}

### Get My Organization Access
GET {{baseUrl}}/api/access/organization/{{orgId}}
Authorization: {{token}}

> {%
    client.test("Get org access returns 200 or 404", function () {
        client.assert([200, 404].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.userId, "UserId should be present");
            client.assert(!!response.body.orgId, "OrgId should be present");
            client.assert(!!response.body.accessLevel, "AccessLevel should be present");
        }
    });
%}

### Get My Organization Access - unauthorized → 401
GET {{baseUrl}}/api/access/organization/{{orgId}}

> {%
    client.test("Get org access requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### List Organization Access (Admin required)
GET {{baseUrl}}/api/access/organization/{{orgId}}/list
Authorization: {{token}}

> {%
    client.test("List org access returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(Array.isArray(response.body), "Expected array of access entries");
        }
    });
%}

### Grant Organization Access (Admin required)
POST {{baseUrl}}/api/access/organization/{{orgId}}/grant
Authorization: {{token}}
Content-Type: application/json

{
  "targetUserId": "{{currentUserId}}",
  "accessLevel": "Read"
}

> {%
    client.test("Grant org access returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.userId, "UserId should be present");
            client.assert(!!response.body.accessLevel, "AccessLevel should be present");
        }
    });
%}

### Revoke Organization Access (Admin required)
DELETE {{baseUrl}}/api/access/organization/{{orgId}}/revoke/{{currentUserId}}
Authorization: {{token}}

> {%
    client.test("Revoke org access returns 204, 403, or 404", function () {
        client.assert([204, 403, 404].includes(response.status));
    });
%}


### Get My Invitations
GET {{baseUrl}}/api/access/invitations
Authorization: {{token}}

> {%
    client.test("Get my invitations returns 200 and array", function () {
        client.assert(response.status === 200);
        client.assert(Array.isArray(response.body), "Expected array of invitations");
    });
%}

### Get My Invitations - unauthorized → 401
GET {{baseUrl}}/api/access/invitations

> {%
    client.test("Get my invitations requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Create Workspace Invitation (Admin required)
POST {{baseUrl}}/api/access/workspace/{{workspaceId}}/invite
Authorization: {{token}}
Content-Type: application/json

{
  "targetUserId": "{{currentUserId}}",
  "accessLevel": "Read"
}

> {%
    if (response.status === 200) {
        client.global.set("invitationId_accept", response.body.id);
    }
    client.test("Create workspace invitation for accept returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.id, "Invitation id should be present");
        }
    });
%}

### Create another Workspace Invitation for Decline (Admin required)
POST {{baseUrl}}/api/access/workspace/{{workspaceId}}/invite
Authorization: {{token}}
Content-Type: application/json

{
  "targetUserId": "{{currentUserId}}",
  "accessLevel": "Read"
}

> {%
    if (response.status === 200) {
        client.global.set("invitationId_decline", response.body.id);
    }
    client.test("Create workspace invitation for decline returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(!!response.body.id, "Invitation id should be present");
        }
    });
%}

### Accept Workspace Invitation
POST {{baseUrl}}/api/access/invitations/{{invitationId_accept}}/accept
Authorization: {{token_new}}

> {%
    client.test("Accept invitation returns 200 or 404", function () {
        client.assert([200, 404].includes(response.status));
    });
%}

### Decline Workspace Invitation
POST {{baseUrl}}/api/access/invitations/{{invitationId_decline}}/decline
Authorization: {{token_new}}

> {%
    client.test("Decline invitation returns 200 or 404", function () {
        client.assert([200, 404].includes(response.status));
    });
%}

### Accept Invitation - unauthorized → 401
POST {{baseUrl}}/api/access/invitations/{{invitationId_decline}}/accept

> {%
    client.test("Accept invitation requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Set Organization Workspace Owner (Owner required on both)
POST {{baseUrl}}/api/access/organization/{{orgId}}/workspace/{{workspaceId}}
Authorization: {{token}}

> {%
    client.test("Set org workspace owner returns 200 or 403", function () {
        client.assert([200, 403].includes(response.status));
        if (response.status === 200) {
            client.assert(response.body.success !== undefined, "Success field should be present");
        }
    });
%}

### Set Organization Workspace Owner - unauthorized → 401
POST {{baseUrl}}/api/access/organization/{{orgId}}/workspace/{{workspaceId}}

> {%
    client.test("Set org workspace owner requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Remove Organization Workspace Owner (Owner required)
DELETE {{baseUrl}}/api/access/organization/{{orgId}}/workspace/{{workspaceId}}
Authorization: {{token}}

> {%
    client.test("Remove org workspace owner returns 204, 403, or 404", function () {
        client.assert([204, 403, 404].includes(response.status));
    });
%}

### Remove Organization Workspace Owner - unauthorized → 401
DELETE {{baseUrl}}/api/access/organization/{{orgId}}/workspace/{{workspaceId}}

> {%
    client.test("Remove org workspace owner requires auth", function () {
        client.assert(response.status === 401);
    });
%}

### Delete Organization (Owner required)
DELETE {{baseUrl}}/api/organization/{{orgId}}
Authorization: {{token}}

> {%
    client.test("Delete organization returns 204 or 403", function () {
        client.assert([204, 403].includes(response.status));
    });
%}

### Delete Organization - unauthorized → 401
DELETE {{baseUrl}}/api/organization/{{missingId}}

> {%
    client.test("Delete organization requires auth", function () {
        client.assert(response.status === 401);
    });
%}



### Logout
POST {{baseUrl}}/api/logout
Authorization: {{token}}

> {%
    client.test("Logout succeeds with 200", function () {
        client.assert(response.status === 200);
    });
%}

### Logout - missing header → 401
POST {{baseUrl}}/api/logout

> {%
    client.test("Logout requires Authorization header", function () {
        client.assert(response.status === 401);
    });
%}

### Logout - invalid token → 401
POST {{baseUrl}}/api/logout
Authorization: invalid-token

> {%
    client.test("Logout fails with invalid token", function () {
        client.assert(response.status === 401);
    });
%}
